<p align="center">
  <a href="http://nestjs.com/" target="blank"><img src="https://nestjs.com/img/logo-small.svg" width="200" alt="Nest Logo" /></a>
</p>

<p align="center">A progressive <a href="http://nodejs.org" target="_blank">Node.js</a> framework for building efficient and scalable server-side applications.</p>

## Описание

Данный проект представляет из себя API для работы с офферами. Используемые технологии: NestJS, TypeScript, Docker, MongoDB, Swagger, Jest.

### Функционал:

- Загрузка офферов со стороннего API.
- Маппинг данных офферов и сохранение их в MongoDB.
- Вычисление рейтинга для офферов.
- Принятие на вход геопозиции и отдача в ответ списка офферов для данной геопозиции.
- Логика пагинации.
- Создание списка всех офферов с группировкой по геопозиции.
- Логика синхронизации с внешним источником для актуализации списка офферов.
- Swagger документация

## Установка

### Выполнить следующие инструкции для установки приложения

```bash
- Скачать проект из репозитория
- Установить NodeJS и Docker на локальную машину
- Создать файл .env в корне проекта и скопировать туда данные из .env.EXAMPLE
- Выполнить команду npm install в терминале в корне проекта
```

### Запуск приложения

```bash
- Запуск базы данных в докер контейнере
$ docker-compose up -d --build

- Запуск приложения в dev режиме:
$ npm run start:dev
```

- ### Во время запуска проекта, автоматически, будет выполнен запрос на сторонний API для загрузки и маппинга данных в базу данных, которая находится в докер контейнере. Проект считается успешно запущенным, когда данные уже сохранены в базу данных.

### Проверка функционала

```bash
GET метод 'all'
http://localhost:3000/api/offers/all
Возвращает полный список офферов из базы данных

GET метод ':geo'
Нужно указать параметр страны
http://localhost:3000/api/offers/RU
По умолчанию query-параметры pageSize = 5, page = 0
Значение pageSize не должно превышать 20
http://localhost:3000/api/offers/RU?page=1&pageSize=19
Возвращает список офферов, у которых в geo присутствует название страны

GET метод 'geo-stats'
http://localhost:3000/api/offers/geo-stats
Возвращает список офферов с группировкой по геопозиции

POST метод 'sync'
http://localhost:3000/api/offers/sync
Запускает синхронизацию со сторонним API для обновления списка офферов в базе данных. Повторный вызов метода заблокирован при неоконченной синхронизации.

Swagger документация
http://localhost:3000/api/docs/
```

### Тестирование

```bash
Запуск unit тестов
$ npm run test
```

- Author - Aleksander Aleksandrov
